<?php require_once("../dbase/dbconnect.php");

$url = "https://street.co.uk/api/property-feed/sales/search?filter%5Btags%5D=alhome&sort=price";
$url_lettings = "https://street.co.uk/api/property-feed/lettings/search?filter%5Btags%5D=alhome&sort=price";

$headers = array(
   "Accept: application/json",
   "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiZDJiOWUxODJkMWUyMzVkNjNlYzk0NDUxZjYxOGRmMGI4NmM1OWUyMTNiZTZjY2EyNzNlYTFkZTc0MGMyMTE4M2IwYzRkYzEwYThlOWQ3NWYiLCJpYXQiOjE2NTk1MzMzNDkuMTY5NzExLCJuYmYiOjE2NTk1MzMzNDkuMTY5NzIsImV4cCI6MTk3NTE1MjU0OC43MjIzMDYsInN1YiI6IjQxNTE4NyIsInNjb3BlcyI6WyJwdWJsaWMtYXBpIl19.dp-wlsrk880Lh6VH5hKX55aZisGi0zGY2XqW-8VSNaMUkyEU_J-8Kq3ht8GlPx2AqQQCmgwNno7dgn2S3QrSgUAJiVechErTAYMMMMPsfYvCikZRHBRpM6WTTG3d21TO0XRxuyRLr7MqZ-KanQkxwYFk_3CwDVbz5WNBdnt0IOjlY65OncYQGrofw42rc11b4MxIyV3oe5gNw-c3Zd0-3-eNvH3yR4QFT8i9SjUCt6rfFOYz8eSuYnJYrVyXSaShtLEy7P4fGkMqQB2tmxo2UzqOuFqKvQ39f0KsBPAXjceEVFP7cHtR6cJv_W3RsfNkUw5Avtlz_M4mCcY_sqYifhYur-Do8PhlqNQS2p7gfwbGxOnvc3T2PZGIWHMQqFEivMLG6rM2heK2VvMcOFoRpEkiQgCGvEoX6lrYpPLz-Whjb3JZhHPmDh3oaVG19I3gT_N6EEs3vnBEOyVkUNFtpzocqLrxihCSB4F-SJ1rnmnBqRasMrgAdHtLaaGNnbUCWttqBodizX5j4lBZluJGplRp9GmbL1ZyCCp4D-wPPsGoLuFBda17DIyV03qOB2ZwnsJZJ7nyjnztc4tNTnGkvK5KWU151cTg8ZeayBVd3KwUIPcbgrZueIqmEGGrCO4WrB5D47_AMv-07k8CkLLytVKdSZi5ndmDkYH3USmRi4o",
);

// Get featured sales properties
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_URL, $url);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);
$properties = json_decode(curl_exec($curl));
curl_close($curl);

// Get featured lettings properties
$curl = curl_init($url_lettings);
curl_setopt($curl, CURLOPT_URL, $url_lettings);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HTTPHEADER, $headers);
$featured_lettings = json_decode(curl_exec($curl));
curl_close($curl);

// sales properties - add to array
$total_sales_properties = $properties->meta->pagination->total;
$Properties[] = new stdClass;
$propcount = 0;
foreach ($properties->data as $property){
    $Properties[$propcount]->property_id = $property->id;
    $Properties[$propcount]->address = strtok($property->attributes->public_address, ',');
    $Properties[$propcount]->bathrooms = $property->attributes->bathrooms;
    $Properties[$propcount]->bedrooms = $property->attributes->bedrooms;
    $Properties[$propcount]->receptions = $property->attributes->receptions;
    $Properties[$propcount]->created = $property->attributes->created_at;
    $Properties[$propcount]->public_url = $property->attributes->public_url;
    $sales_listing_id = $property->relationships->salesListing->data->id;
    $primary_image_id = $property->relationships->primaryImage->data->id;
    $address_id = $property->relationships->address->data->id;
    foreach ($properties->included as $data){
         if ($data->id ==  $sales_listing_id) {
             $Properties[$propcount]->price_qualifier = $data->attributes->price_qualifier;
             $Properties[$propcount]->price = $data->attributes->price;
             $Properties[$propcount]->status = $data->attributes->status;
         }
         if ($data->id == $address_id) {
              $Properties[$propcount]->postcode = strtok($data->attributes->postcode,  ' ');
         }
          if ($data->id == $primary_image_id) {
              $Properties[$propcount]->image = $data->attributes->urls->full;
         }
    }
    $propcount++;
}
// lettings 
$total_lettings_properties = $featured_lettings->meta->pagination->total;
$Lettings_properties[] = new stdClass;
$propcount = 0;
foreach ($featured_lettings->data as $lettings_property){
    $Lettings_properties[$propcount]->property_id = $lettings_property->id;
    $Lettings_properties[$propcount]->address = strtok($lettings_property->attributes->public_address, ',');
    $Lettings_properties[$propcount]->bathrooms = $lettings_property->attributes->bathrooms;
    $Lettings_properties[$propcount]->bedrooms = $lettings_property->attributes->bedrooms;
    $Lettings_properties[$propcount]->receptions = $lettings_property->attributes->receptions;
    $Lettings_properties[$propcount]->created = $lettings_property->attributes->created_at;
    $Lettings_properties[$propcount]->public_url = $lettings_property->attributes->public_url;
    $Lettings_properties[$propcount]->status = $lettings_property->attributes->status;
    $lettings_listing_id = $lettings_property->relationships->lettingsListing->data->id;
    $lettings_primary_image_id = $lettings_property->relationships->primaryImage->data->id;
    $address_id = $lettings_property->relationships->address->data->id;
    foreach ($featured_lettings->included as $data){
         if ($data->id ==  $lettings_listing_id) {
             $Lettings_properties[$propcount]->deposit = $data->attributes->deposit;
             $Lettings_properties[$propcount]->price = $data->attributes->price_pcm;
         }
         if ($data->id == $address_id) {
              $Lettings_properties[$propcount]->postcode = strtok($data->attributes->postcode,  ' ');
         }
          if ($data->id == $lettings_primary_image_id) {
             $Lettings_properties[$propcount]->image = $data->attributes->urls->full;
         }
    }
    $propcount++;
}

$property_url = "property/property.php"; 
$lettings_property_url = "property/lettings_property.php";
//get banners 
$dbname2 = "andrewlo_website";
mysqli_select_db($link, $dbname2);
$sql_banner = "SELECT * FROM homeBanners WHERE enabled = '1' ORDER BY position ASC";
$result_banner = mysqli_query($link, $sql_banner);  

$banner = array();
while($row = mysqli_fetch_array($result_banner)) {
    $banner[] = $row;
}
// get areas for auto-complete
$sql2 = "SELECT area FROM areas";
$data = array();
$result2 = mysqli_query($link, $sql2);
while ($row=mysqli_fetch_array($result2)) 
{
 $data[] = $row['area'];
}

// get latest 20 reviews
$sql_reviews = "SELECT id, DATE_FORMAT(date, '%d %M %Y') AS ukdate, name, heading, comments, rating FROM reviews ORDER BY date DESC LIMIT 20";
$result_reviews = mysqli_query($link, $sql_reviews);  
$reviews = array();
while($row = mysqli_fetch_array($result_reviews)) {
    $reviews[] = $row;
}
$sql_total_reviews = "SELECT COUNT(*) AS total FROM reviews";
$result_total_reviews = mysqli_query($link, $sql_total_reviews);
$review_total = mysqli_fetch_array($result_total_reviews);

$sql_avg = "SELECT AVG(rating) AS averageRating FROM reviews";
$result_avg = mysqli_query($link, $sql_avg);  
$review_avg = mysqli_fetch_array($result_avg);

mysqli_close($link); 

//display the first 22 words of a string.
function wordSplit($string){
$array = explode(" ", $string);
$arr22 = array_slice($array, 0, 22);
$description = "";
foreach ($arr22 as $words) {
$description = $description . $words . " ";
}
echo trim($description) . "...";
}

//display average stars
function starAverage($rating) {

switch ($rating) {
  case ($rating >= 4.75 && $rating <= 5):
    echo '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>';//5 stars
    break;
  case ($rating >= 4.25 && $rating < 4.75):
    echo '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half"></i>';//4 and a half stars
    break;
  case ($rating >= 3.75 && $rating < 4.25):
     echo '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>';//4 stars
    break;
  case ($rating >= 3.25 && $rating < 3.75):
     echo '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half"></i>';//3 and a half stars
    break;   
  case ($rating >= 2.75 && $rating < 3.25):
     echo '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>';//3 stars
    break;    
  case ($rating >= 2.25 && $rating < 2.75):
     echo '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>';//2 and a half stars
    break;
  case ($rating >= 1.75 && $rating < 2.25):
     echo '<i class="fas fa-star"></i><i class="fas fa-star"></i>';//2 stars
    break;   
  case ($rating >= 1.25 && $rating < 1.75):
     echo '<i class="fas fa-star"></i><i class="fas fa-star-half"></i>';//1 and a half stars
    break;  
  case ($rating >= 0.75 && $rating < 1.25):
     echo '<i class="fas fa-star"></i>';//1 star
    break;  
   case ($rating >= 0.25 && $rating < 0.75):
     echo '<i class="fas fa-star-half"></i>';//half a star
    break;  
}    
}
   
include 'scripts/check_price.php';
?>
<!DOCTYPE html>
<html lang="en">
   <head><meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-64373876-1"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'UA-64373876-1');
      </script>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="format-detection" content="telephone=no">
      <title>Andrew Louis Estate Agents</title>
      <meta name="description" content="Liverpool's leading property agents. Our services include sales, lettings, property management, commercial, mortgages and block service charge management.">
      <meta name="keywords" content="Andrew Louis, estate agent, Liverpool Estate Agents, block management, sales, commercial, residential, lettings, property, houses, flats, flats for sale, apartments for sale, estate management">
      <link rel="stylesheet" href="styles/home.css">
      <link rel="stylesheet" type="text/css" href="scripts/slick/slick.css"/>
      <link rel="stylesheet" type="text/css" href="scripts/slick/slick-theme.css"/>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Ibarra+Real+Nova:wght@500&display=swap" rel="stylesheet">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
      <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
      <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
      <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
      <script defer src="//use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
      <script src="scripts/search.js" type="text/javascript"></script>

      <script>
        $( function() {
        var availableTags = <?php echo json_encode($data); ?>;
        //autocomplete areas
        $( "#textsearch" ).autocomplete({
          source: function( request, response ) {
                  var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( request.term ), "i" );
                  response( $.grep( availableTags, function( item ){
                      return matcher.test( item );
                  }) );
              }
        });
        
        $( "#textsearch2" ).autocomplete({
          source: function( request, response ) {
                  var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( request.term ), "i" );
                  response( $.grep( availableTags, function( item ){
                      return matcher.test( item );
                  }) );
              }
        });

        });
    </script>
    
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Andrew Louis Estate Agents and Property Management">
    <meta property="og:description" content="As one of Liverpool’s leading independent estate agents we are able to offer you local knowledge and expert advice whatever your requirements">
    <meta property="og:image" content="https://www.andrewlouis.co.uk/images/nav/AL_Logo.jpg">
    <meta property="og:url" content="https://www.andrewlouis.co.uk">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64x64.png">
    <link rel="shortcut icon" href="/favicon-64x64.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">
   </head>

   <body onload="evenpanels();">
      <?php require '../alweb/topmenu.php'?>
      <!-- Carousel -->
      <div id="myCarousel" class="carousel" data-ride="carousel">
         <!-- Indicators -->
         <ol class="carousel-indicators">
            <?php for ($x = 0; $x < sizeof($banner); $x++) {
            if ($x == 0) { 
                echo '<li data-target="#myCarousel" data-slide-to="' . $x . '" class="active"></li>';
            }
            else {
                echo '<li data-target="#myCarousel" data-slide-to="' . $x . '"></li>';
            } } ?>  
         </ol>
    <!-- Wrapper for slides -->
    <div class="carousel-inner" role="listbox">
    <?php foreach($banner as $slide) {
    if ($slide["position"] == 1) { ?>
         <div class="item active">
             <?php if (!empty($slide['web_link'])) { ?>
                 <a href="<?php echo $slide['web_link'] ?>">
                <img src="images/home/<?php echo $slide['photo'] ?>" alt="Banner<?php echo $slide['position'] ?>">
                </a>
             <?php }
             else { ?>
            <img src="images/home/<?php echo $slide['photo'] ?>" alt="Banner<?php echo $slide['position'] ?>">
            <?php } ?>
             <div class="carousel-caption">
                 <?php if (!empty($slide['web_link'])) { ?>
                    <a href="<?php echo $slide['web_link'] ?>" style="text-decoration: none; color: white"><h1><?php  echo $slide["heading"] ?></h1></a>
                    <a href="<?php echo $slide['web_link'] ?>" style="text-decoration: none; color: white"><h3><?php  echo $slide["sub_heading"] ?></h3></a>
                 <?php }
                 else { ?>
                    <h1><?php  echo $slide["heading"] ?></h1>
                    <h3><?php  echo $slide["sub_heading"] ?></h3>
                <?php } ?>
             </div>
        </div>
    <?php }
    else { echo '<div class="item">';  ?>
             <?php if (!empty($slide['web_link'])) { ?>
                 <a href="<?php echo $slide['web_link'] ?>">
                <img src="images/home/<?php echo $slide['photo'] ?>" alt="Banner<?php echo $slide['position'] ?>">
                </a>
             <?php }
    else { ?>
            <img src="images/home/<?php echo $slide['photo'] ?>" alt="Banner<?php echo $slide['position'] ?>">
            <?php } ?>
           <div class="carousel-caption">
               <?php if (!empty($slide['web_link'])) { ?>
                    <a href="<?php echo $slide['web_link'] ?>" style="text-decoration: none; color: white"><h1><?php  echo $slide["heading"] ?></h1></a>
                    <a href="<?php echo $slide['web_link'] ?>" style="text-decoration: none; color: white"><h3><?php  echo $slide["sub_heading"] ?></h3></a>
                 <?php }
                 else { ?>
                    <h1><?php  echo $slide["heading"] ?></h1>
                    <h3><?php  echo $slide["sub_heading"] ?></h3>
                <?php } ?>
            </div>
        </div>
    <?php } } ?>
    </div>
         <!-- Left and right controls -->
         <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
         <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
         <span class="sr-only">Previous</span>
         </a>
         <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
         <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
         <span class="sr-only">Next</span>
         </a>       </div>
         
      <div class="container-fluid searchengine">
          <!-- Property Search -->
         <div class="row">
            <div class="center-block">
               <h3 style="color: #d0d8cd">Find your perfect property</h3>
            </div> 
         </div>
         <div class="row" style="margin 0px; padding 0px">        
               <form class="form-inline" name="propertysearch" id="propertysearch"  method="get" action="property/select2.php" autocomplete="off">
         </div>
        <div class="row">

        <div class="col-sm-12 col-md-2 col-lg-2 col-lg-offset-1">
                  <div class="input-group searchInput" >
                     <span class="input-group-addon searchIcon">Looking to </span>
                     <select class="form-control " name="selecttype" id="selecttype" onChange="updateprices()" style="width:100%">
                        <option value="1">Buy</option>
                        <option value="2">Rent</option>
                     </select>
                  </div>
                </div>
                  
                    <div class="col-sm-6 col-md-3 col-lg-2">
                  <div class="input-group searchInput">
                     <span class="input-group-addon searchIcon" style="min-width: 60px">Min</span>
                     <select class="form-control" name="minprice" id="minprice">
                        <option value="0">No Min</option>
                        <option value="50000">£50,000</option>
                        <option value="100000">£100,000</option>
                        <option value="150000">£150,000</option>
                        <option value="200000">£200,000</option>
                        <option value="250000">£250,000</option>
                        <option value="500000">£500,000</option>
                        <option value="750000">£750,000</option>
                     </select>
                  </div>
                  </div>

                <div class="col-sm-6 col-md-3 col-lg-2">
                     <div class="input-group searchInput">
                     <span class="input-group-addon searchIcon" style="min-width: 60px">Max</span>
                     <select class="form-control" name="maxprice" id="maxprice">
                        <option value="100000000">No Max  </option>
                        <option value="50000">£50,000</option>
                        <option value="100000">£100,000</option>
                        <option value="150000">£150,000</option>
                        <option value="200000">£200,000</option>
                        <option value="250000">£250,000</option>
                        <option value="500000">£500,000</option>
                        <option value="750000">£750,000</option>
                     </select>
                  </div>
                </div>
                <div class="visible-md visible-lg col-sm-12 col-md-4 col-lg-4 ">
                  <div class="input-group searchInput" >
                              <span class="input-group-addon searchIcon" style="min-width: 60px"><i class="glyphicon glyphicon-pushpin"></i></span>
                     <input type="text" class="form-control" placeholder="Enter Area or Postcode" name="textsearch" id="textsearch">
                  </div>
                </div>

        </div>
        <div class="row">
            <div class="col-sm-6  col-md-3 col-md-offset-2 col-lg-2 col-lg-offset-3">
                        <div class="input-group searchInput">
                     <span class="input-group-addon searchIcon" style="min-width: 60px"><i class="glyphicon glyphicon-home"></i></span>
                     <select class="form-control" name="proptype">
                        <option value="1">All Types</option>
                        <option value="2">Apartment</option>
                        <option value="3">House</option>
                        <option value="4">Commercial</option>
                     </select>
                  </div>
                  
    </div>
     <div class="col-sm-6  col-md-3 col-lg-2 ">
                     <div class="input-group searchInput">
                     <span class="input-group-addon searchIcon" style="min-width: 60px"><i class="glyphicon glyphicon-bed"></i></span>
                     <select class="form-control" name="bedrooms">
                        <option value="0">No Min</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4 or More</option>
                     </select>
                  </div>
    </div>
    
     <div class=" visible-xs visible-sm col-sm-12 col-md-4 col-lg-4 ">
                  <div class="input-group searchInput" >
                              <span class="input-group-addon searchIcon" style="min-width: 60px"><i class="glyphicon glyphicon-pushpin"></i></span>
                     <input type="text" class="form-control" placeholder="Enter Area or Postcode" name="textsearch2" id="textsearch2">
                  </div>
    </div>
     <div class="col-sm-12 col-md-4 col-lg-4 ">
                  <button class="btn btn-success" type="submit" style="width:100%"><span class="glyphicon glyphicon-search"></span> Search</button>
               </form>
               </div></div>
            </div>
      <!-- Featured Properties -->
      <div class="container-fluid " >
         <div class="row">
             
            <div class="col-sm-12 col-md-12">
                
               <h1>Featured Properties</h1>
               <div class="row">
                  <div class="col-sm-12"></div>
               </div>
               <div class="row" style="padding-right:2px">
                  <div class="responsive">
                     <?php 
                     if ($total_sales_properties > 0){
                     foreach($Properties as $prop): ?>
                     <div class="propertyDiv">
                        <div class="thumbnail propertyThumbnail">
                           <?php if ($prop->status == "Sold STC") {echo '<div class="numberCircleUO" title="SOLD Subject to Contract"><span class="textCircleUO">SOLD <span style="font-size: 14px">STC</span></span></div>';}
                            else if(checkthedate($prop->created)) {echo '<div class="numberCircle"><span class="textCircle">NEW</span></div>';} ;?> 
                           <a href="<?php echo $property_url . "?id=" . $prop->property_id;?>"> <img class="propertyImage" src="<?php echo $prop->image;?>" alt="Property" onerror="this.onerror=null;this.src='property/awaiting_photo.jpg';"> </a>
                           <h3 class="addresshead"><?php echo $prop->address;?></h3>
                            <h5 class="addressPostcode"> <?php echo $prop->postcode;?> </h5>
                               <h3 class="addressprice">&pound;<?php echo number_format($prop->price); ?><span style="font-weight: lighter; color:#636f7f; font-size: 70%"></span></h3>
                           <hr>
                           <p class="text-center" style="padding-left: 4px"><i class="glyphicon glyphicon-bed" style="padding-right: 4px"></i> <span style="padding-right: 13px;"><?php checkBedrooms($prop->bedrooms);?> </span> <i class="fas fa-couch"></i><span style="padding-left: 4px; padding-right: 13px;"><?php checkRooms($prop->receptions, 'Receptions');?></span> <i class="fas fa-bath"></i><span style="padding-left: 4px;"><?php checkRooms($prop->bathrooms, 'Bathrooms');?></span></p>
                           <a href="<?php echo $property_url . "?id=" . $prop->property_id;?>" class="moreDetailsButton"> <button type="button" class="btn btn-secondary btn-lg btn-block">More Details</button> </a>
                        </div>
                     </div>
                     <?php endforeach; 
                     };?>
                     <?php 
                     if($total_lettings_properties > 0) {
                     foreach($Lettings_properties as $prop): ?>
                     <div class="propertyDiv">
                       <div class="thumbnail propertyThumbnail">
                           <?php if ($prop->status == "Now Let") {echo '<div class="numberCircleUO"><span class="textCircleUO" style="font-size: 20px;">NOW LET</span></div>';}
                            else if(checkthedate($prop->created)) {echo '<div class="numberCircle"><span class="textCircle">NEW</span></div>';} ;?> 
                           <a href="<?php echo $lettings_property_url . "?id=" . $prop->property_id;?>"> <img class="propertyImage" src="<?php echo $prop->image;?>" alt="Property" onerror="this.onerror=null;this.src='property/awaiting_photo.jpg';"> </a>
                           <h3 class="addresshead"><?php echo $prop->address;?></h3>
                            <h5 class="addressPostcode"> <?php echo $prop->postcode;?> </h5>
                               <h3 class="addressprice">&pound;<?php echo number_format($prop->price); ?><span style="font-weight: lighter; color:#636f7f; font-size: 70%"> PCM</span></h3>
                           <hr>
                           <p class="text-center" style="padding-left: 4px"><i class="glyphicon glyphicon-bed" style="padding-right: 4px"></i> <span style="padding-right: 13px;"><?php checkBedrooms($prop->bedrooms);?> </span> <i class="fas fa-couch"></i><span style="padding-left: 4px; padding-right: 13px;"><?php checkRooms($prop->receptions, 'Receptions');?></span> <i class="fas fa-bath"></i><span style="padding-left: 4px;"><?php checkRooms($prop->bathrooms, 'Bathrooms');?></span></p>
                           <a href="<?php echo $lettings_property_url . "?id=" . $prop->property_id;?>" class="moreDetailsButton"> <button type="button" class="btn btn-secondary btn-lg btn-block">More Details</button> </a>
                        </div>
                      </div>
                     <?php endforeach; 
                     };?> 
                  </div>
               </div>
            </div>

            
         </div>
      </div>
      <div class="container-fluid slide" id="propertyWorthBar"><a href="valuation">
         <h2 class="text-center propertyWorthText"><i class="fa fa-calculator"></i> Selling or Letting your property?  Get an instant online valuation in 30 seconds</h2></a>
      </div>
      <div class="container-fluid" style="background-color: #2f2f2f;" >
         <div class="row text-center" style="margin: 20px 20px 20px 20px; background-color: #2f2f2f;">
            <div class="col-sm-4">
               <div class="thumbnail findoutbox">
                  <h3 class="visible-lg visible-xs boldText">Report a Maintenance Issue</h3>
                  <h4 class="visible-sm visible-md boldText">Report a Maintenance Issue</h4>
                  <img src="images/home/home_maintenance.jpg" alt="Report Maintenance Issue">
                      <p style="font-size:110%">If you're a tenant in a managed property you can report your maintenance issues online here 
                    </p>
                    <a href="renting/report-repair" style=" color: black; text-decoration:none">
                  <button class="btn btnInfo">
                     <h4 class="visible-lg visible-xs">FIND OUT MORE</h4>
                     <h5 class="visible-sm visible-md">FIND OUT MORE</h5>
                  </button></a>
               </div>
            </div>
            <div class="col-sm-4">
               <div class="thumbnail findoutbox">
                  <h3 class="visible-lg visible-xs boldText">Selling at Auction?</h3>
                  <h4 class="visible-sm visible-md boldText">Selling at Auction?</h4>
                  <img src="images/home/home_auction.jpg" alt="Selling at Auction">
                  <p style="font-size:110%">Sell your home quickly through our modern method of auction for 0% agency fees.</p> 	
                    <a href="//andrewlouis.iamsold.co.uk/" style=" color: black; text-decoration:none">
                  <button class="btn btnInfo">
                     <h4 class="visible-lg visible-xs">FIND OUT MORE</h4>
                     <h5 class="visible-sm visible-md">FIND OUT MORE</h5>
                  </button></a>
               </div>
            </div>
            <div class="col-sm-4">
               <div class="thumbnail findoutbox">
                   <h3 class="visible-lg visible-xs boldText">Investing in Property</h3>
                  <h4 class="visible-sm visible-md boldText">Investing in Property</h4>
                  <img src="images/home/home_invest.jpg" alt="Investing in Liverpool">
                  <p style="font-size:110%">We specialise in finding the very best rental properties in the Liverpool region.</p>
                  <a href="buying/buytolet" style=" color: black; text-decoration:none">
                  <button class="btn btnInfo">
                     <h4 class="visible-lg visible-xs">FIND OUT MORE</h4>
                     <h5 class="visible-sm visible-md">FIND OUT MORE</h5>
                  </button></a>
               </div>
            </div>
         </div>
      </div>
            <div class="container-fluid" id="propertyWorthBar"><a href="/about/news">
         <h2 class="text-center propertyWorthText"><i class="far fa-newspaper"></i> View our latest news articles and helpful tips</h2></a>
      </div>
      <div class="container">
          <div class="row">
        <div class="col-sm-12 col-md-12">
                     <div class="review_title text-center"><h2>Testimonials</h2></div>
         <!-- Testimonials -->     
         <div class="reviews" style="margin-left:10px; margin-right:10px">
             <?php foreach($reviews as $review): ?>  
              <div class="review_box" id="<?php echo $review['id'] ?>" data-toggle="modal" data-target="#testimonialModal" data-id="<?php echo $review['id'] ?>">
              <div class="review_star"><?php for ($x = 1; $x <= $review['rating']; $x++) {echo '<i class="fas fa-star"></i>';}?>
            </div>
              <div class="review_heading"><?php echo $review['heading']; ?></div>
              <div class="review_comments">
                <p><?php if(strlen($review['comments']) > 220) {wordSplit(htmlspecialchars_decode($review['comments']));} else{ echo htmlspecialchars_decode($review['comments']); }; ?></p>
              </div>
              <div class="review_name"><?php echo $review['name'] . " - " . $review['ukdate'] ?></div>
              </div>
            <?php endforeach; ?> 
         </div>
         <hr>
          <div class="average_rating text-center"> <p>Average Customer Rating: <?php echo number_format($review_avg['averageRating'], 1); ?>/5 <span style="color:orange"><?php starAverage(number_format($review_avg['averageRating'], 2)); ?></span>
         | based on <?php echo $review_total['total'] ; ?> reviews </p>                       
         <h4 class="text-center"><span class="followUs"> Follow us on:   </span>
                     <a href="//facebook.com/andrewlouislimited"><i style="padding-left:10px;" class="fab fa-facebook socialicons"></i></a>
                     <a href="//twitter.com/Andrew__Louis"><i style="padding-left:10px;" class="fab fa-twitter-square socialicons"></i></a>
                     <a href="//instagram.com/andrewlouisestateagents/"><i style="padding-left:10px;" class="fab fa-instagram socialicons"></i></a>
                     </h4></div>
        </div>
        </div>
        </div>
 
      <div class="container-fluid" style="background-color: #2f2f2f;">
         <div class="row menucolumns" style="margin:0px 20px 5px 20px;color: white;background-color:#2f2f2f;">
            <div class="col-sm-3">
               <h4 class="footerHeader">Buying</h4>
               <h5 class="footerMenu"><a href="buying/process">The Buying Process</a></h5>
               <h5 class="footerMenu"><a href="buying/buytolet">Buy-to-let Investments</a> </h5>
               <h5 class="footerMenu"><a href="buying/stampduty">Stamp Duty Calculator</a> </h5>
               <h5 class="footerMenu"><a href="buying/toptips">Top tips for buyers</a></h5>
               <hr style="border-color: #9fa09d">
                <h4 class="footerHeader">Selling</h4>
               <h5 class="footerMenu"><a href="selling/benefits">Benefits of Selling with us</a> </h5>
               <h5 class="footerMenu"><a href="selling/services">Sales service options</a></h5>
               <h5 class="footerMenu"><a href="//andrewlouis.iamsold.co.uk/properties/sold">Quick sale service</a></h5>
               <h5 class="footerMenu"><a href="selling/process" >The selling process</a></h5>
               <h5 class="footerMenu"><a href="selling/toptips">Top tips for sellers</a></h5>
               </div>
            <div class="col-sm-3">
                <h4 class="footerHeader">Renting</h4>
               <h5 class="footerMenu"><a href="renting/process">The renting process</a></h5>
               <h5 class="footerMenu"><a href="renting/toptips">Top tips for renters</a></h5>
               <h5 class="footerMenu"><a href="renting/report-repair">Report a maintenance issue</a></h5>
                <hr style="border-color: #9fa09d">
               <h4 class="footerHeader">Landlords</h4>
               <h5 class="footerMenu"><a href="landlords/benefits">Benefits of letting with us</a></h5>
               <h5 class="footerMenu"><a href="landlords/services">Landlord Service Options</a></h5>
               <h5 class="footerMenu"><a href="landlords/process">The Letting Process</a></h5>
               <h5 class="footerMenu"><a href="landlords/toptips">Top tips for landlords</a> </h5>
            </div>
            <div class="col-sm-3">
               <h4 class="footerHeader">Block Management</h4>
               <h5 class="footerMenu"><a href="block/services" >Management services</a></h5>
               <h5 class="footerMenu"><a href="block/why">Why move to us?</a></h5>
               <h5 class="footerMenu"><a href="block/finance">Finance and Administration</a></h5>
               <h5 class="footerMenu"><a href="block/faqs">FAQs</a></h5>
               <h5 class="footerMenu"><a href="block/leaseholders">Leaseholders</a></h5>
               <h5 class="footerMenu"><a href="block/myblock">My Block Login</a></h5>
               <hr style="border-color: #9fa09d">
               <h4 style="color:#a5d1a9">About us</h4>
               <h5 class="footerMenu"><a href="about/timeline">Our Story</a> </h5>
               <h5 class="footerMenu"><a href="about/team">Meet the Team</a></h5>
               <h5 class="footerMenu"><a href="about/careers">Careers</a></h5>
               <h5 class="footerMenu"><a href="about/news">Latest News</a> </h5>
               <h5 class="footerMenu"><a href="about/contact">Contact us</a> </h5>
            </div>
            <div class="col-sm-3">
                <div class="well text-center" style="background-color:white; color: #3f5354; margin-top:12px">
                    <h2 class="visible-xs visible-md visible-lg">You're in Safe Hands</h2>
                    <h3 class="visible-sm">You're in Safe Hands</h3>
                    <hr>
                    <h4 class="visible-xs visible-md visible-lg">We are a voluntary member of the key governing bodies, abiding by the strictest codes of practice</h4>
                    <h5 class="visible-sm">We are a voluntary member of the key governing bodies, abiding by the strictest codes of practice</h5>
                    <img src="images/home/member_logos.jpg" usemap="#image-map" alt="logos" width="90%">
                    <map name="image-map">
                            <area target="" alt="Safe Agent Certificate" title="Safe Agent Certificate" href="certs/safeAgentCert2021.pdf" coords="7,8,371,76" shape="rect">
                    </map>
                </div>
            </div>
         </div>
      </div>
      
<div class="container">
  <!-- Testimonial Modal -->
  <div class="modal fade" id="testimonialModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-body">
          <p name="modalReview" id="modalReview" class="review_comments"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
</div>

      <script type="text/javascript">
         $(document).ready(function(){
         $('.responsive').slick({
           dots: false,
           arrows: false,
           infinite: true,
           speed: 300,
           slidesToShow: 4,
           slidesToScroll: 1,
           autoplay: true,
           autoplaySpeed: 3000,
           responsive: [
             {
               breakpoint: 1126,
               settings: {
                 slidesToShow: 2,
                 slidesToScroll: 1,
                 infinite: true,
                 dots: false
               }
             },
             {
               breakpoint: 615,
               settings: {
                 slidesToShow: 1,
                 slidesToScroll: 1
               }
             },
             {
               breakpoint: 480,
               settings: {
                 slidesToShow: 1,
                 slidesToScroll: 1
               }
             }
           ]
         });
         
         $('.reviews').slick({
  dots: false,
  arrows: true,
//        prevArrow: '<li><span class="arrow arrow-right"></span></li>',
//        nextArrow: '<li><span class="arrow arrow-right"></span></li>',
  infinite: false,
  speed: 300,
  slidesToShow: 3,
  slidesToScroll: 3,
  responsive: [
    {
      breakpoint: 1224,
      settings: {
        slidesToShow: 3,
        slidesToScroll: 3,
        infinite: true,
        dots: false,
        arrows: true
      }
    },
        {
      breakpoint: 1024,
      settings: {
        slidesToShow: 2,
        slidesToScroll: 2
      }
    },
    {
      breakpoint: 640,
      settings: {
        slidesToShow: 1,
        slidesToScroll: 1
      }
    },
    {
      breakpoint: 480,
      settings: {
        slidesToShow: 1,
        slidesToScroll: 1
      }
    }
  ]
});

        //modify below to use on above modal
        $(document).on("click", ".review_box", function () {
          var review_id = $(this).data('id');
            $.ajax({
             url:'scripts/getReview.php',
             type:"POST",
             dataType: 'json',
             data:{id:review_id},
             success:function(data){
                document.getElementById("modalReview").innerHTML = data.comments;
             }

            });
        });

         });
      </script>
      <script type="text/javascript" src="scripts/slick/slick.min.js"></script>

    <?php require '../alweb/footer.php'?>
     	<script>
     	
	// Keep all panels the same height
     $(window).resize(evenpanels);
	
	function evenpanels() {
    var heights = [];                           // make an array
    $(".findoutbox").each(function(){           // copy the height of each
        heights.push($(this).height());         // element to the array
    });
    heights.sort(function(a, b){return b - a}); // sort the array high to low
    var minh = heights[0];                      // take the highest number    
    $(".findoutbox").height(minh);              // and apply that to each element
}

$(window).resize(function () { 
        $(".findoutbox").each(function(){
            $(this).css('height',"");           // clear height values
        });                                     
        evenpanels();
});

	</script>
 <?php require '../alweb/onlinechat.php'?>
   </body>
</html>
